from fastapi import FastAPI, Request
from pydantic import BaseModel
from datetime import datetime

app = FastAPI()

class Komenda(BaseModel):
    typ: str
    tresc: str

logi = []

@app.get("/status")
def status():
    return {"status": "działa", "czas": datetime.now().isoformat()}

@app.post("/log")
async def dodaj_log(request: Request):
    body = await request.json()
    logi.append({"czas": datetime.now().isoformat(), "dane": body})
    return {"ok": True, "ilosc_logow": len(logi)}

@app.post("/komenda")
def odbierz_komende(k: Komenda):
    logi.append({"czas": datetime.now().isoformat(), "komenda": k.dict()})
    return {"status": "komenda przyjęta", "typ": k.typ, "tresc": k.tresc}
