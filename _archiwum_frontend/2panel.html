<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>ğŸ§  Panel gÅ‚Ã³wny projektu AI</title>
  <style>
    body { font-family: Arial; margin: 40px; background: #f4f4f4; }
    h1, h2 { color: #333; }
    .blok { background: #fff; padding: 10px; margin: 10px 0; border-left: 4px solid #0078D7; position: relative; }
    .usun { position: absolute; right: 10px; top: 10px; background: #e00; color: #fff; border: none; padding: 5px; cursor: pointer; }
    input, button, select { padding: 8px; margin-top: 10px; }
    #sugestia { margin-top: 20px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸ§  Panel gÅ‚Ã³wny projektu AI</h1>

  <!-- Etapy projektu -->
  <section>
    <h2>ğŸ“Œ Etapy projektu AI</h2>
    <button onclick="zaproponujKrok()">ğŸ’¡ Zaproponuj kolejny krok</button>
    <div id="sugestia">ğŸ” Tu pojawi siÄ™ sugestia AI</div>
    <div id="etapy">â³ Åadowanie etapÃ³w...</div>
  </section>

  <!-- Zasady systemu -->
  <section>
    <h2>ğŸ“‹ Lista zasad</h2>
    <input type="text" id="tresc" placeholder="TreÅ›Ä‡ zasady">
    <button onclick="dodaj()">â• Dodaj zasadÄ™</button>
    <div id="lista">â³ Åadowanie zasad...</div>
  </section>

  <!-- Makro -->
  <section>
    <h2>âš™ï¸ Wykonaj makro</h2>
    <button onclick="wykonajMakro()">â–¶ï¸ Wykonaj makro 'sprawdz_panel'</button>
  </section>

  <script>
    // Zasady
    async function pobierz() {
      const res = await fetch("http://127.0.0.1:8000/zasady");
      const zasady = await res.json();
      const lista = document.getElementById("lista");
      lista.innerHTML = "";
      zasady.forEach(z => {
        const div = document.createElement("div");
        div.className = "blok";
        div.innerHTML = `
          <strong>${z.czas}</strong><br>${z.tresc}
          <button class="usun" onclick="usun('${z.czas}')">ğŸ—‘ï¸ UsuÅ„</button>
        `;
        lista.appendChild(div);
      });
    }

    async function dodaj() {
      const tresc = document.getElementById("tresc").value;
      const czas = new Date().toISOString();
      const zasada = { czas, tresc };
      await fetch("http://127.0.0.1:8000/dodaj_zasade", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ ilosc: 1, zasady: [zasada] })
      });
      document.getElementById("tresc").value = "";
      pobierz();
    }

    async function usun(czas) {
      await fetch("http://127.0.0.1:8000/usun_zasade", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ czas })
      });
      pobierz();
    }

    // Etapy
    async function pobierzEtapy() {
      const res = await fetch("http://127.0.0.1:5000/etapy");
      const etapy = await res.json();
      const container = document.getElementById("etapy");
      container.innerHTML = "";

      etapy.forEach(etap => {
        const div = document.createElement("div");
        div.className = "blok";
        div.innerHTML = `
          <strong>${etap.id} â€“ ${etap.nazwa}</strong><br>
          Status: 
          <select onchange="zmienStatus('${etap.id}', this.value)">
            <option value="todo" ${etap.status === "todo" ? "selected" : ""}>ğŸŸ  Do zrobienia</option>
            <option value="in_progress" ${etap.status === "in_progress" ? "selected" : ""}>ğŸ”µ W trakcie</option>
            <option value="done" ${etap.status === "done" ? "selected" : ""}>ğŸŸ¢ UkoÅ„czono</option>
          </select>
          Priorytet: 
          <select onchange="zmienPriorytet('${etap.id}', this.value)">
            <option value="wysoki" ${etap.priorytet === "wysoki" ? "selected" : ""}>ğŸ”´ Wysoki</option>
            <option value="sredni" ${etap.priorytet === "sredni" ? "selected" : ""}>ğŸŸ¡ Åšredni</option>
            <option value="niski" ${etap.priorytet === "niski" ? "selected" : ""}>âšª Niski</option>
          </select>
          <br><em>${etap.opis || "Brak opisu"}</em>
        `;
        container.appendChild(div);
      });
    }

    async function zmienStatus(id, status) {
      await fetch("http://127.0.0.1:5000/update-status", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, status })
      });
      pobierzEtapy();
    }

    async function zmienPriorytet(id, priorytet) {
      await fetch("http://127.0.0.1:5000/update-priorytet", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ id, priorytet })
      });
      pobierzEtapy();
    }

    async function zaproponujKrok() {
      const res = await fetch("http://127.0.0.1:5000/etapy");
      const etapy = await res.json();

      const priorytety = { "wysoki": 3, "sredni": 2, "niski": 1 };
      const kandydaci = etapy
        .filter(e => e.status === "todo")
        .map(e => ({ waga: priorytety[e.priorytet] || 2, etap: e }))
        .sort((a, b) => b.waga - a.waga);

      const div = document.getElementById("sugestia");
      if (kandydaci.length === 0) {
        div.innerText = "âœ… Wszystkie etapy wykonane lub w trakcie.";
        return;
      }

      const najlepszy = kandydaci[0].etap;
      div.innerHTML = `
        ğŸ’¡ <strong>${najlepszy.nazwa}</strong><br>
        ğŸ“Œ Status: ${najlepszy.status} | Priorytet: ${najlepszy.priorytet}<br>
        ğŸ“ ${najlepszy.opis || "Brak opisu"}
      `;
    }

    function wykonajMakro() {
      alert("ğŸ”§ Makro 'sprawdz_panel' zostaÅ‚o uruchomione.");
      // Tu moÅ¼esz dodaÄ‡ logikÄ™ makra
    }

    // Start
    pobierz();
    pobierzEtapy();
  </script>
</body>
</html>
